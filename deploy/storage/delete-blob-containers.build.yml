trigger: none

pool:
  name: 'Azure Pipelines'

steps:
- task: AzureCLI@2
  displayName: 'Purge Stale BLOBs from Azure Storage Account'
  inputs:
    azureSubscription: $(ServiceConnection)
    scriptType: bash
    scriptPath: 'deploy/storage/delete-old-blobs.sh'
    arguments: $(PreProdKeyVaultName) $(PreProdResourceGroup) $(IpAddress) $(IpAddress2) $(IpAddress3)
- task: AzureCLI@2
  displayName: 'Add Build Server IPv4 Address to Prod KeyVault'
  inputs:
    azureSubscription: $(ProdServiceConnection)
    scriptType: bash
    scriptPath: 'deploy/build-defs/add-key-vault-ip.sh'
    arguments: $(ProdKeyVaultName) $(ProdResourceGroup) $(IpAddress) $(IpAddress2) $(IpAddress3)
