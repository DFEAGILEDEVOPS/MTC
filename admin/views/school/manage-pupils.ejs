<header class="page-header">
    <%- partial('partials/_breadcrumbs', { breadcrumbs: breadcrumbs }) %>
    <h1 class="heading-xlarge">Manage pupils</h1>
</header>
<div class="grid-row">
    <div class="column-two-thirds">
        <p class="lede">Use this section to add and edit pupils and generate PINs for pupils</p>
        <p><a class="button button-secondary" href="/school/pupil/add" role="button">Add pupils</a></p>
    </div>
</div>
<% if (schoolPin.length > 0) { %>
<div class="grid-row">
    <div class="column-one-half">
        <div class="box-light-grey">
            <div class="left-padding">
                <p class="font-small">School password for <%= formatFullGdsDate(todayDate) %></p>
                <div class="font-xxlarge"><strong><%= schoolPin %></strong></div>
            </div>
        </div>
    </div>
    <div class="column-one-half"></div>
</div>
<% } %>
<% if (typeof pupils !== 'object' || Object.keys(pupils).length < 1) { %>
  <p>No pupils found</p>
<% } else { %>
    <% const candidates = pupils.filter((p) => !p.hasScore)%>
    <div class="grid-row">
        <div class="column-one-half">
            <h3 class="heading-medium heading-border-top">Pupils to take check</h3>

            <form method="post" action="/school/generate-pins" autocomplete="off">
                <div class="form-group box-grey form-horizontal">
                    <input class="button" type="submit" value="Generate PIN(s)">
                    <a href="/school/print-pupils" class="pupils-print-pins">Print PINs</a>
                </div>

                <table class="spacious" id="pupilsList">
                    <thead>
                        <tr>
                            <th scope="col" class="multiple-choice tick-all-boxes">
                                <% if (candidates.some((p) => !p.pin)) { %>
                                <input id="tickAllCheckboxes" name="allPupils" type="checkbox">
                                <% } %>
                                <label for="allPupils">Pupil</label>
                            </th>
                            <th scope="col" class="multiple-choice tick-all-boxes-nojs">Pupil</th>
                            <th class="side-padding"></th>
                            <th scope="col" class="nowrap">Pupil PIN</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% candidates.forEach( (candidate, index) => { %>
                        <tr>
                            <td>
                                <div class="multiple-choice pupils-list">
                                    <% if (candidate.pin === null) { %>
                                    <input id="pupil-<%= candidate._id %>"
                                           name="pupil[<%= index %>]"
                                           type="checkbox"
                                           value="<%= candidate._id %>">
                                    <% } %>
                                    <label for="pupil-<%= candidate._id %>">
                                        <strong><%= candidate.foreName %> <%= candidate.lastName %></strong><br />
                                        <span class="font-xsmall">Date of birth: <%= candidate.dob %></span>
                                    </label>
                                </div>
                            </td>
                            <td>
                                <a href="/school/pupil/edit/<%= candidate._id %>" class="font-xsmall"><i>edit</i></a>
                            </td>
                            <td>
                                <% if (candidate.pin !== null) { %>
                                    <% if (candidate.pinExpired === true) { %>
                                    <span class="font-xsmall font-greyed-out italic">PIN expired</span>
                                    <% } else { %>
                                    <span ><%= candidate.pin %></span>
                                    <% } %>
                                <% } else { %>
                                <span class="font-greyed-out">n/a</span>
                                <% } %>
                            </td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </form>
        </div>
        <div class="column-one-half">
            <h3 class="heading-medium heading-border-top">Check completed</h3>
            <% const pupilsCompleted = pupils.filter((p) => p.hasScore)%>
            <% if (pupilsCompleted.length < 1) { %>
            <p>No pupils completed</p>
            <% } else { %>
            <table class="spacious" id="resultsList">
                <thead>
                    <tr>
                        <th scope="col">Pupil</th>
                        <th scope="col">Results</th>
                    </tr>
                </thead>
                <tbody>
                <% pupilsCompleted.forEach((pupil) => { %>
                <tr>
                    <td>
                        <strong><%= pupil.foreName %> <%= pupil.lastName %></strong><br />
                        <span class="font-xsmall">Date of birth: <%= pupil.dob %></span>
                    </td>
                    <td>
                        <span><%= pupil.percentage %></span>
                    </td>
                </tr>
                <% }) %>
                </tbody>
            </table>
            <% } %>
        </div>
    </div>
<% } %>
