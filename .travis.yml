dist: bionic
os: linux
language: node_js
services:
  - docker
node_js:
  - 12.18.2
before_install:
  - node ./deploy/should-it-build.js $TRAVIS_PULL_REQUEST
  - cd admin-assets
  - "./copy-assets.sh"
  - cd ..
jobs:
  - stage: build docker admin app
    script:
      - cd admin
      - docker build .
      - docker images
  - stage: build docker admin assets
    script:
      - cd admin-assets
      - docker build .
      - docker images
  - stage: build pupil SPA
    script:
      - cd pupil-spa
      - docker build .
      - docker images
  - stage: build pupil API
    script:
      - cd pupil-api
      - docker build .
      - docker images
  - stage: validate ruby gems in admin
    language: ruby
    rvm: 2.6.0
    before_install:
      - node ./deploy/should-it-build.js $TRAVIS_PULL_REQUEST
    script:
      - cd test/admin-hpa
      - bundle install
      - rake -T
  - stage: validate ruby gems in pupil app
    language: ruby
    rvm: 2.6.0
    before_install:
      - node ./deploy/should-it-build.js $TRAVIS_PULL_REQUEST
    script:
      - cd test/pupil-hpa
      - bundle install
      - rake -T
