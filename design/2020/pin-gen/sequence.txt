pupil pin controller->checkStartService: prepareCheck2(pupilIds, dfeNumber, schoolId, isLiveCheck, schoolTimezone=null)
checkStartService->pinGenerationV2Service: getPupilsEligibleForPinGenerationById(schoolId, pupilIds, isLiveCheck)
pinGenerationV2Service->pinGenerationDataService: sqlFindPupilsEligibleForPinGenerationById(schoolId, pupilIds, isLiveCheck)
pinGenerationDataService->sqlService: query(sql, params)
sqlService->SQLDB: select()
checkStartService->setValidationService: validate(pupilIds, pupils)
checkStartService->checkWindowDataService: sqlFindOneCurrent()
checkWindowDataService->checkWindowDataService: sqlFindCurrent(null, null)
checkWindowDataService->sqlService: query(sql, params)
sqlService->SQLDB: select()
checkStartService->checkFormService: getAllFormsForCheckWindowByType(checkWindowId, isLiveCheck)
checkFormService->checkFormDataService: sqlFetchSortedActiveFormsByName(checkWindowId)
checkFormDataService->sqlService: query(sql, params)
sqlService->SQLDB: select()
checkStartService->checkDataService: sqlFindAllFormsUsedByPupils(pupilIds)
checkDataService->sqlService: query(sql, params)
sqlService->SQLDB: select()
checkStartService->checkStartService: initialisePupilCheck(pupilId, checkWindow, allForms, usedFormIds, isLiveCheck, schoolId, schoolTimezone)
checkStartService->checkFormService: allocateCheckForm(availableForms, usedFormIds)
checkStartService->pinGenerationService: getPinExpiryTime(schoolTimezone)
checkStartService->pinGenerationDataService: sqlFindChecksForPupilsByIds(schoolId, newCheckIds, pupilIds)
checkStartService->pinGenerationV2Service: checkAndUpdateRestarts(schoolId, pupils, newCheckIds)
